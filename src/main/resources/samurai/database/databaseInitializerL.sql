CREATE TABLE Player (
  discordId   BIGINT      NOT NULL PRIMARY KEY,
  osuId       INT         NOT NULL UNIQUE,
  osuName     VARCHAR(16) NOT NULL,
  globalRank  INT         NOT NULL,
  countryRank INT         NOT NULL,
  level       FLOAT       NOT NULL,
  rawPP       FLOAT       NOT NULL,
  accuracy    FLOAT       NOT NULL,
  playCount   INT         NOT NULL,

  countX      INT,
  countS      INT,
  countA      INT,

  count300    INT,
  count100    INT,
  count50     INT,

  modes       SMALLINT    NOT NULL DEFAULT 1,

  lastUpdated BIGINT      NOT NULL
);

CREATE TABLE Guild (
  guildId BIGINT      NOT NULL PRIMARY KEY,
  prefix  VARCHAR(16) NOT NULL,
  modules BIGINT      NOT NULL
);

CREATE TABLE Chart (
  chartId INT         NOT NULL PRIMARY KEY         GENERATED BY DEFAULT AS IDENTITY
                                                     ( START WITH 2001, INCREMENT BY 1),
  name    VARCHAR(32) NOT NULL,
  isSet   BOOLEAN     NOT NULL                     DEFAULT TRUE
);

CREATE TABLE ChartMap (
  chartId  INT NOT NULL,
  mapSetId INT NOT NULL,
  CONSTRAINT ChartMap_PK PRIMARY KEY (ChartId, MapSetId),
  CONSTRAINT ChartId_FK FOREIGN KEY (ChartId) REFERENCES Chart (ChartId)
);

CREATE TABLE GuildChart (
  guildId BIGINT NOT NULL,
  chartId INT    NOT NULL,
  CONSTRAINT GuildChart_PK PRIMARY KEY (GuildId, ChartId),
  CONSTRAINT GuildId_FK FOREIGN KEY (GuildId) REFERENCES GUILD (GuildId),
  CONSTRAINT ChartId_FK2 FOREIGN KEY (ChartId) REFERENCES CHART (ChartId)
);

CREATE TABLE GuildPlayer (
  guildId   BIGINT   NOT NULL,
  discordId BIGINT   NOT NULL,
  mode      SMALLINT NOT NULL,
  CONSTRAINT GuildPlayer PRIMARY KEY (DiscordId, GuildId, Mode),
  CONSTRAINT DiscordId_FK FOREIGN KEY (DiscordId) REFERENCES Player (DiscordId),
  CONSTRAINT GuildId_FK2 FOREIGN KEY (GuildId) REFERENCES GUILD (GuildId)
);


CREATE TABLE ChannelMode (
  channelId BIGINT   NOT NULL,
  guildId   BIGINT   NOT NULL,
  mode      SMALLINT NOT NULL,
  CONSTRAINT ChannelMode PRIMARY KEY (ChannelId),
  CONSTRAINT GuildId_FK3 FOREIGN KEY (GuildId) REFERENCES Guild (GuildId)
);

CREATE TABLE ChannelLock (
  guildId   BIGINT NOT NULL,
  channelId BIGINT NOT NULL,
  CONSTRAINT ChannelLock_PK PRIMARY KEY (GuildId, ChannelId),
  CONSTRAINT GUILDId_FK4 FOREIGN KEY (GuildId) REFERENCES Guild (GuildId)
);

CREATE TABLE MapSet (
  mapId INT NOT NULL,
  setId INT NOT NULL,
  CONSTRAINT MapSet_PK PRIMARY KEY (MapId)
);