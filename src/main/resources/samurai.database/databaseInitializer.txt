CREATE TABLE Player
(
  UserID   BIGINT      NOT NULL PRIMARY KEY,
  OsuID       INT         NOT NULL UNIQUE,
  OsuName     VARCHAR(16) NOT NULL,
  GlobalRank  INT         NOT NULL,
  CountryRank INT         NOT NULL,
  LastUpdated BIGINT      NOT NULL
);

CREATE TABLE Guild (
  GuildID  BIGINT      NOT NULL PRIMARY KEY,
  Prefix   VARCHAR(16) NOT NULL,
  Commands BIGINT      NOT NULL
);

CREATE TABLE Chart (
  ChartID INT         NOT NULL PRIMARY KEY         GENERATED BY DEFAULT AS IDENTITY
                                                     ( START WITH 255, INCREMENT BY 1),
  Name    VARCHAR(32) NOT NULL,
  IsSet   BOOLEAN     NOT NULL                     DEFAULT TRUE
)

CREATE TABLE ChartMap (
  ChartID  INT NOT NULL,
  MapSetID INT NOT NULL,
  CONSTRAINT ChartMap_PK PRIMARY KEY (ChartId, MapSetId),
  CONSTRAINT ChartId_FK FOREIGN KEY (ChartId) REFERENCES Chart (ChartId)
);

CREATE TABLE GuildChart (
  GuildID BIGINT NOT NULL,
  ChartID INT    NOT NULL,
  CONSTRAINT GuildChartPK PRIMARY KEY (GuildID, ChartID),
  CONSTRAINT GuildID_FK2 FOREIGN KEY (GuildID) REFERENCES GUILD (GuildID),
  CONSTRAINT ChartID_FK2 FOREIGN KEY (ChartID) REFERENCES CHART (ChartID)
);

CREATE TABLE PlayerChannel (
  UserID      BIGINT      NOT NULL,
  ChannelID   BIGINT      NOT NULL,
  Mode        CHAR(1)     NOT NULL,
  CONSTRAINT PlayerChannelMode_PK PRIMARY KEY (DiscordId, ChannelId, Mode),
  CONSTRAINT UserID_FK FOREIGN KEY (UserID) REFERENCES PLAYER (UserID)
);

CREATE TABLE MapSet (
  MapID INT NOT NULL,
  SetID INT NOT NULL,
  CONSTRAINT MapSet_PK PRIMARY KEY (MapID)
);
